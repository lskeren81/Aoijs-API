"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Compiler=void 0;class Compiler{functions=[];regex=null;matched=null;result="";code;constructor(e){this.code=e}set_functions(e){return e=e.sort((e,s)=>s.length-e.length),this.functions=e,this.regex=new RegExp(`(${e.join("|").replace(/\$/g,"\\$")})`,"gi"),this}set_code(e){return this.code=e}match(){if(this.regex&&this.code){let d={},c=this.code,t=(this.code?.match(this.regex)?.reverse()?.map((t,l)=>{var r=c.split(t).slice(-1).join(""),l="FUNCTION_"+l;if(r.startsWith("[")){let e="",s=0,i;for(var o of r.slice(1)){if("]"==o&&s<=0)break;"["==o?(e+=o,s++):"]"==o&&0<s?(e+=o,s--):e+=o}i=`${t}[${e}]`,d[l]={resolve_fields:()=>{},resolve_field:()=>{},fields:e.split(";").map(e=>({value:e.trim(),overs:[]})),name:t,inside:e,total:i,id:l},c=c.replaceLast(i,l)}else d[l]={resolve_fields:()=>{},resolve_field:()=>{},fields:null,inside:null,total:t,name:t,id:l},c=c.replaceLast(t,l)}),d),e=Object.values(d);return e.forEach(i=>{if(i.inside&&i.fields)return e.some(e=>e.fields?.some(e=>e.overs.some(e=>e.id==i.id)))?delete d[i.id]:void i.fields.forEach((e,s)=>{e.value.match(/FUNCTION_\d+/g)?.forEach(e=>{t[e]&&(d[i.id].fields[s].overs.push(t[e]),delete d[e])})})}),this.result=c,this.matched=d}}}exports.Compiler=Compiler;