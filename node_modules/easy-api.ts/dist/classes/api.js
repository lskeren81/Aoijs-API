"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.API=void 0;const tslib_1=require("tslib"),tiny_typed_emitter_1=require("tiny-typed-emitter"),express_1=tslib_1.__importDefault(require("express")),routes_1=require("./routes"),interpreter_1=require("./interpreter"),utils_1=require("./utils");class API extends tiny_typed_emitter_1.TypedEmitter{port;db;app;routes;interpreter;constructor(e){super();let t;if("mongo"===e.database?.type?.toLowerCase()){if(e.database?.enabled){var s=require("quickmongo").Database;if(!e.database?.mongoUrl)throw new Error("Invalid MONGO_URL provided in database options.");(t=new s(e.database.mongoUrl)).connect()}}else"replit"===e.database?.type?.toLowerCase()?e.database?.enabled&&(s=require("@replit/database"),t=new s):"quickdb"===e.database?.type?.toLowerCase()?e.database?.enabled&&(s=require("quick.db").QuickDB,t=new s):"default"!==e.database?.type?.toLowerCase()&&e.database?.type||e.database?.enabled&&(s=require("midb").Database,t=new s);if(e.spaces&&isNaN(e.spaces)||e.spaces&&(10<=e.spaces||e.spaces<=0))throw new SyntaxError("Invalid spaces number provided in constructor.");this.db=t,this.port=e.port,this.app=(0,express_1.default)(),this.routes=new routes_1.Endpoints(this.app),this.interpreter=new interpreter_1.Interpreter(this.app,this.routes,this.db,!!e.reverseReading),this.app.set("json spaces",e.spaces||1)}setSpaces(e){e=Number(e),(isNaN(e)||e<=0||10<=e)&&utils_1.Utils.Warn("Invalid spaces number provided in:","<API>.setSpaces()"),this.app.set("json spaces",e)}set404(s){this.on("ready",()=>{this.app.all("*",(e,t)=>{this.interpreter.parse(s,e,t).catch(e=>{this.emit("error",e)})})})}connect(){for(const s of this.routes.getRoutes())this.app.get(s.path,(e,t)=>{this.interpreter.parse(s.code,e,t).catch(e=>{this.emit("error",e)})});this.app.listen(this.port,()=>{this.emit("ready",this.app)})}}exports.API=API;