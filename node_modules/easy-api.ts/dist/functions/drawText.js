"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.data=void 0;const builder_1=require("../classes/builder"),utils_1=require("../classes/utils");function fillText(d,s,r,l,c,u,a,o){var f=Number(d.font.match(/[\d]{1,5}px/g)[0].replace("px",""));if(!(c<=0||u<=0||f<=0)){var m=l+u;let t=l+u/2+f/2,i,n=("right"===a?(i=r+c,d.textAlign="right"):"left"===a?(i=r,d.textAlign="left"):(i=r+c/2,d.textAlign="center"),[]);s.split("\n").forEach(r=>{let l=d.measureText(r).width;if(l<=c)n.push(r);else{let e=r;var u=c;let t,i,s;for(l=d.measureText(e).width;l>u;){for(t=0,i=0,s="";i<u;)t++,s=e.substr(0,t),i=d.measureText(e.substr(0,t)).width;t--,s=s.substr(0,t);var a=t;if(" "!=e.substr(t,1)){for(;" "!=e.substr(t,1)&&0!=t;)t--;0==t&&(t=a),s=e.substr(0,t)}s=s,e=e.substr(t),l=d.measureText(e).width,n.push(s)}0<l&&n.push(e)}});const x=(0,utils_1.getTextHeight)(d,s,d.font);a=x*(n.length-1);let e=l;"top"===o?t=l+f:"bottom"===o?(t=m-a,e=m):(e=l+u/2,t-=a/2),n.forEach(e=>{e=e.trim(),d.fillText(e,i,t),t+=x})}}exports.data={data:(new builder_1.FunctionBuilder).setName("drawText").setValue("description","Draws a text in the canvas.").setValue("use","$drawText[text;x;y;width;height;align?(right|left|center);vAlign?(top|bottom|middle)]").setValue("returns","Void"),code:async e=>{var t,i,s,r,l,u,a;return await e.func?.resolve_fields(e),e.func?.inside?e.func.fields.length<3?utils_1.Utils.Warn("Invalid fields provided in:",e.func.name):([t,i,s,r,l,u="left",a="top"]=e.func.fields.map(({value:e})=>e),utils_1.Utils.isNumber(i)&&utils_1.Utils.isNumber(s)&&utils_1.Utils.isNumber(r)&&utils_1.Utils.isNumber(l)?e._.Canvas?.ctx?(fillText(e._.Canvas.ctx,t.unescape(),Number(i),Number(s),Number(r),Number(l),u,a),{code:e.code.replace(e.func?.id,"")}):utils_1.Utils.Warn("Not canvas found, create one first using $createCanvas, in:",e.func.name):utils_1.Utils.Warn("Some numer is invalid in:",e.func.name)):utils_1.Utils.Warn("Invalid inside provided in:",e.func?.name)}};